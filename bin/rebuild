#!/usr/bin/env bash
# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail
IFS=$'\n\t'

sudo printf '' # make sure password prompt won't pop up later, be perhaps hard to detect
# set -e
intershop_host_path=$(pwd)
# home=$(realpath "$(readlink -f "$0" | xargs dirname)"/..)
home="$(realpath "$(realpath "${BASH_SOURCE[0]}" | xargs dirname)"/..)"
cd "$home"

#-----------------------------------------------------------------------------------------------------------
source bin/_prepare-environment
bin/_restart-rpc-server

#-----------------------------------------------------------------------------------------------------------
_sudo_postgres_unpaged_pre  -f db/teardown.sql                    2>&1 | grep -P '^.*ERROR.*$|' --color=always
_postgres_unpaged_pre       -f "$intershop_sql_buildscript_path"  2>&1 | grep -P '^.*ERROR.*$|' --color=always



